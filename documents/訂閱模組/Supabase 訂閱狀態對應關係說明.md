# Supabase è¨‚é–±ç‹€æ…‹å°æ‡‰é—œä¿‚èªªæ˜

## ğŸ“‹ æ–‡ä»¶æ¦‚è¿°

æœ¬æ–‡ä»¶èªªæ˜ Next-Clerk-Polar-Supabase Starter Kit ä¸­ï¼Œå¦‚ä½•é€é Supabase è³‡æ–™åº«æ¬„ä½ä¾†åˆ¤æ–·ç”¨æˆ¶çš„ä¸‰ç¨®è¨‚é–±ç‹€æ…‹ã€‚é©åˆæ–°é€²å·¥ç¨‹å¸«èˆ‡ PM å¿«é€Ÿç†è§£ç³»çµ±é‚è¼¯ã€‚

### æ–‡ä»¶è³‡è¨Š
- **å»ºç«‹æ—¥æœŸ**: 2025-07-20
- **ç‰ˆæœ¬**: 2.0 (ç°¡åŒ–ç‰ˆ)
- **ç›®æ¨™è®€è€…**: æ–°é€²å·¥ç¨‹å¸«ã€ç”¢å“ç¶“ç†ã€QA æ¸¬è©¦äººå“¡
- **ç¶­è­·è€…**: é–‹ç™¼åœ˜éšŠ

---

## ğŸ¯ ä¸‰ç¨®ç”¨æˆ¶è¨‚é–±ç‹€æ…‹

### 1. ğŸ“ˆ è¨‚é–±ä¸­ã€æœƒçºŒè¨‚
- **ç”¨æˆ¶ç‹€æ…‹**: å·²ä»˜è²»ï¼Œè¨‚é–±æœƒè‡ªå‹•çºŒè²»
- **æ¬Šé™**: äº«æœ‰å®Œæ•´å°ˆæ¥­ç‰ˆåŠŸèƒ½
- **ç”¨æˆ¶é«”é©—**: ç„¡éœ€ä»»ä½•æ“ä½œï¼Œæœå‹™æŒçºŒ

### 2. â° è¨‚é–±ä¸­ã€æ™‚é–“åˆ°æœƒåˆ°æœŸ  
- **ç”¨æˆ¶ç‹€æ…‹**: å·²ä»˜è²»ï¼Œä½†ç”¨æˆ¶ä¸»å‹•å–æ¶ˆäº†çºŒè¨‚
- **æ¬Šé™**: ç›®å‰ä»æœ‰å°ˆæ¥­ç‰ˆåŠŸèƒ½ï¼Œåˆ°æœŸå¾Œå¤±æ•ˆ
- **ç”¨æˆ¶é«”é©—**: æœƒçœ‹åˆ°åˆ°æœŸæé†’ï¼Œå¯ä»¥é‡æ–°å•Ÿç”¨

### 3. ğŸ†“ å…è²»ç‰ˆ
- **ç”¨æˆ¶ç‹€æ…‹**: æœªä»˜è²»æˆ–è¨‚é–±å·²éæœŸ
- **æ¬Šé™**: åƒ…æœ‰åŸºæœ¬åŠŸèƒ½
- **ç”¨æˆ¶é«”é©—**: æœƒçœ‹åˆ°å‡ç´šæç¤º

---

## ğŸ—„ï¸ è³‡æ–™åº«æ¬„ä½èªªæ˜

### é—œéµæ¬„ä½

| æ¬„ä½åç¨± | èªªæ˜ | ç¯„ä¾‹å€¼ |
|---------|------|--------|
| `subscription_plan` | è¨‚é–±æ–¹æ¡ˆ | `'pro'` æˆ– `null` |
| `subscription_status` | è¨‚é–±ç‹€æ…‹ | `'active'`, `'inactive'` |
| `current_period_end` | è¨ˆè²»é€±æœŸçµæŸæ™‚é–“ | `'2025-08-20 10:30:00'` |
| `cancel_at_period_end` | æ˜¯å¦åœ¨é€±æœŸçµæŸæ™‚å–æ¶ˆ | `true` æˆ– `false` |

---

## ğŸ” ä¸‰ç¨®ç‹€æ…‹çš„åˆ¤æ–·è¦å‰‡

### ğŸ“Š ç‹€æ…‹å°æ‡‰è¡¨

| è¨‚é–±ç‹€æ…‹ | subscription_plan | subscription_status | cancel_at_period_end | current_period_end | æ¬Šé™ |
|---------|------------------|-------------------|---------------------|-------------------|------|
| **æœƒçºŒè¨‚** | `'pro'` | `'active'` | `false` | `> ç¾åœ¨æ™‚é–“` | âœ… å®Œæ•´åŠŸèƒ½ |
| **æœƒåˆ°æœŸ** | `'pro'` | `'active'` | `true` | `> ç¾åœ¨æ™‚é–“` | âœ… å®Œæ•´åŠŸèƒ½ |
| **å…è²»ç‰ˆ** | `null` | `'inactive'` | `false` | `null` | âŒ åŸºæœ¬åŠŸèƒ½ |

### ğŸ” ç°¡æ˜“åˆ¤æ–·é‚è¼¯

#### 1. è¨‚é–±ä¸­ã€æœƒçºŒè¨‚ âœ…
```
âœ“ æ˜¯å°ˆæ¥­ç‰ˆ (subscription_plan = 'pro')
âœ“ ç‹€æ…‹ç”Ÿæ•ˆ (subscription_status = 'active')  
âœ“ ä¸æœƒå–æ¶ˆ (cancel_at_period_end = false)
âœ“ é‚„æ²’åˆ°æœŸ (current_period_end > ç¾åœ¨æ™‚é–“)
```

#### 2. è¨‚é–±ä¸­ã€æœƒåˆ°æœŸ â°
```
âœ“ æ˜¯å°ˆæ¥­ç‰ˆ (subscription_plan = 'pro')
âœ“ ç‹€æ…‹ç”Ÿæ•ˆ (subscription_status = 'active')
âœ“ æœƒå–æ¶ˆ (cancel_at_period_end = true)
âœ“ é‚„æ²’åˆ°æœŸ (current_period_end > ç¾åœ¨æ™‚é–“)
```

#### 3. å…è²»ç‰ˆ ğŸ†“
```
æ²’æœ‰ä»˜è²»æ–¹æ¡ˆ (subscription_plan = null)
æˆ– ç‹€æ…‹æœªç”Ÿæ•ˆ (subscription_status = 'inactive')
æˆ– å·²ç¶“éæœŸ (current_period_end < ç¾åœ¨æ™‚é–“)
```

---

## ğŸ”„ ç‹€æ…‹è½‰æ›æµç¨‹

### ç”¨æˆ¶å‡ç´šæµç¨‹
```
å…è²»ç‰ˆ â†’ ä»˜è²»å‡ç´š â†’ è¨‚é–±ä¸­(æœƒçºŒè¨‚)
```

### ç”¨æˆ¶å–æ¶ˆè¨‚é–±æµç¨‹  
```
è¨‚é–±ä¸­(æœƒçºŒè¨‚) â†’ å–æ¶ˆçºŒè¨‚ â†’ è¨‚é–±ä¸­(æœƒåˆ°æœŸ) â†’ å…è²»ç‰ˆ
```

### ç”¨æˆ¶é‡æ–°å•Ÿç”¨æµç¨‹
```
è¨‚é–±ä¸­(æœƒåˆ°æœŸ) â†’ é‡æ–°å•Ÿç”¨ â†’ è¨‚é–±ä¸­(æœƒçºŒè¨‚)
```

---

## â° è‡ªå‹•åˆ°æœŸè™•ç†æ©Ÿåˆ¶

### ğŸ¤– Polar è‡ªå‹•åŒ–æµç¨‹

ç•¶ç”¨æˆ¶è¨‚é–±åˆ°æœŸæ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•è™•ç†ï¼Œç„¡éœ€äººå·¥å¹²é ï¼š

#### å®Œæ•´æµç¨‹
```
ç”¨æˆ¶å–æ¶ˆè¨‚é–± â†’ è¨­å®šåˆ°æœŸæ¨™è¨˜ â†’ äº«å—æœå‹™è‡³é€±æœŸçµæŸ â†’ Polar è‡ªå‹•è§¸ç™¼åˆ°æœŸäº‹ä»¶ â†’ ç³»çµ±è‡ªå‹•é™ç´šç‚ºå…è²»ç‰ˆ
```

#### è™•ç†æ™‚æ©Ÿ
1. **ç«‹å³**: ç”¨æˆ¶å–æ¶ˆæ™‚è¨­å®š `cancel_at_period_end = true`
2. **æŒçºŒ**: ç”¨æˆ¶ä»å¯ä½¿ç”¨å°ˆæ¥­ç‰ˆåŠŸèƒ½ç›´åˆ° `current_period_end`
3. **åˆ°æœŸ**: Polar åœ¨åˆ°æœŸæ™‚é–“è‡ªå‹•ç™¼é€é€šçŸ¥
4. **é™ç´š**: ç³»çµ±è‡ªå‹•å°‡ç”¨æˆ¶æ”¹ç‚ºå…è²»ç‰ˆ

#### å„ªå‹¢
- âœ… **å®Œå…¨è‡ªå‹•åŒ–**: ç„¡éœ€äººå·¥ç›£æ§
- âœ… **ç”¨æˆ¶å‹å–„**: ä»˜è²»æœŸé–“æŒçºŒäº«å—æœå‹™
- âœ… **ç²¾ç¢ºæ§åˆ¶**: æº–ç¢ºçš„æ™‚é–“ç®¡ç†
- âœ… **å¯é å®‰å…¨**: è‡ªå‹•é‡è©¦å’ŒéŒ¯èª¤è™•ç†

---

## ğŸ“Š å¸¸è¦‹å•é¡Œèˆ‡è§£ç­”

### Q1: ç‚ºä»€éº¼ç”¨æˆ¶å–æ¶ˆè¨‚é–±å¾Œé‚„èƒ½ä½¿ç”¨å°ˆæ¥­ç‰ˆï¼Ÿ
**A**: ç”¨æˆ¶å·²ç¶“ä»˜è²»åˆ°ç•¶å‰é€±æœŸçµæŸï¼Œè®“ä»–å€‘äº«å—å®Œæ•´çš„ä»˜è²»æœŸé–“æ˜¯åˆç†çš„ã€‚

### Q2: ç³»çµ±å¦‚ä½•çŸ¥é“ä½•æ™‚å°‡ç”¨æˆ¶é™ç´šï¼Ÿ
**A**: Polar æœƒåœ¨ `current_period_end` æ™‚é–“åˆ°é”æ™‚è‡ªå‹•ç™¼é€é€šçŸ¥ï¼Œç³»çµ±æ¥æ”¶å¾Œè‡ªå‹•è™•ç†é™ç´šã€‚

### Q3: å¦‚æœè‡ªå‹•è™•ç†å¤±æ•—æ€éº¼è¾¦ï¼Ÿ
**A**: Polar æœ‰è‡ªå‹•é‡è©¦æ©Ÿåˆ¶ï¼ŒæœƒæŒçºŒå˜—è©¦ç›´åˆ°è™•ç†æˆåŠŸã€‚

### Q4: ç”¨æˆ¶å¯ä»¥åœ¨åˆ°æœŸå‰é‡æ–°å•Ÿç”¨è¨‚é–±å—ï¼Ÿ
**A**: å¯ä»¥ï¼Œåªè¦åœ¨ `current_period_end` ä¹‹å‰ï¼Œç”¨æˆ¶éƒ½å¯ä»¥é‡æ–°å•Ÿç”¨è‡ªå‹•çºŒè¨‚ã€‚

---

## ğŸ¯ æ¸¬è©¦æª¢æŸ¥è¦é»

### åŸºæœ¬åŠŸèƒ½æ¸¬è©¦
- [ ] æ–°ç”¨æˆ¶é è¨­ç‚ºå…è²»ç‰ˆ
- [ ] å‡ç´šå¾Œç‹€æ…‹æ­£ç¢ºé¡¯ç¤ºç‚ºã€ŒæœƒçºŒè¨‚ã€
- [ ] å–æ¶ˆå¾Œç‹€æ…‹è®Šç‚ºã€Œæœƒåˆ°æœŸã€
- [ ] é‡æ–°å•Ÿç”¨å¾Œè®Šå›ã€ŒæœƒçºŒè¨‚ã€
- [ ] åˆ°æœŸå¾Œè‡ªå‹•è®Šç‚ºã€Œå…è²»ç‰ˆã€

### æ¬Šé™æ¸¬è©¦
- [ ] å°ˆæ¥­ç‰ˆç”¨æˆ¶å¯ä»¥ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½
- [ ] å…è²»ç‰ˆç”¨æˆ¶åªèƒ½ä½¿ç”¨åŸºæœ¬åŠŸèƒ½
- [ ] å³å°‡åˆ°æœŸç”¨æˆ¶ä»å¯ä½¿ç”¨å°ˆæ¥­ç‰ˆåŠŸèƒ½

### è‡ªå‹•åŒ–æ¸¬è©¦
- [ ] åˆ°æœŸæ™‚è‡ªå‹•é™ç´šæ­£å¸¸é‹ä½œ
- [ ] ç‹€æ…‹é¡¯ç¤ºæº–ç¢ºåæ˜ å¯¦éš›æ¬Šé™
- [ ] ç”¨æˆ¶ä»‹é¢æç¤ºæ¸…æ¥šæ˜“æ‡‚

---

## ğŸ“ ç¸½çµ

é€é Supabase çš„å››å€‹é—œéµæ¬„ä½ï¼Œæˆ‘å€‘å¯ä»¥æº–ç¢ºè¿½è¹¤å’Œç®¡ç†ç”¨æˆ¶çš„è¨‚é–±ç‹€æ…‹ï¼š

1. **ç²¾ç¢ºæ§åˆ¶**: æ¸…æ¥šå€åˆ†ä¸‰ç¨®è¨‚é–±ç‹€æ…‹
2. **è‡ªå‹•åŒ–è™•ç†**: Polar è‡ªå‹•è™•ç†åˆ°æœŸäº‹ä»¶
3. **ç”¨æˆ¶å‹å–„**: å–æ¶ˆå¾Œä»å¯äº«å—å®Œæ•´ä»˜è²»æœŸé–“
4. **æ¥­å‹™å¯é **: ç¢ºä¿è¨ˆè²»æº–ç¢ºå’Œæœå‹™é€£çºŒæ€§

é€™å€‹è¨­è¨ˆç¢ºä¿äº†ç³»çµ±çš„å¯é æ€§å’Œç”¨æˆ¶é«”é©—çš„ä¸€è‡´æ€§ï¼ŒåŒæ™‚ç‚ºæ¥­å‹™åˆ†ææä¾›äº†æ¸…æ™°çš„è³‡æ–™åŸºç¤ã€‚

---

**æ–‡æª”ç‰ˆæœ¬**: 2.0 (ç°¡åŒ–ç‰ˆ)  
**æœ€å¾Œæ›´æ–°**: 2025-07-20  
**ç¶­è­·è€…**: é–‹ç™¼åœ˜éšŠ  
**ç‹€æ…‹**: âœ… å·²å®Œæˆ