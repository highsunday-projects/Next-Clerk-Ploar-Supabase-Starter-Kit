---
author: <作者>
date: <YYYY-MM-DD>
title: <一句話說明重構目標>
uuid: 897267db5a584ee99fd697514305b1b5
version: <版本號>
---

# 重構需求書 – 重構XXX任務

## 1. 目標  
簡短描述為何要重構，以及完成後的主要好處。  
> 例如：  
> - 解決 /grid 與 /taxi-data 邏輯重複  
> - 讓開發更易維護、測試

## 2. 使用者故事  
- **As a** 開發人員  
- **I want** 有一個統一的資料取得流程  
- **So that** 減少重複程式碼、快速定位問題

## 3. 重構細項說明

| 編號 | 說明 | 調整重點 | 注意事項 |
|------|------|-----------|----------|
| R1   | 統一資料入口 | 建立 `fetchMapData()` 封裝 `/grid` 與 `/taxi-data` | 回傳格式要與原邏輯一致 |
| R2   | 去重與快取 | 同條件下避免多次發送請求 | 可考慮 `Map` 快取機制 |
| R3   | 錯誤處理一致化 | 統一錯誤格式與前端顯示邏輯 | 不影響頁面載入，UI 顯示需清楚 |
| R4   | 模組重組 | 將 `gridService`、`taxiDataService` 合併為一模組 | 新模組需補單元測試 |
| R5   | 向下相容 | 重構後 API 與前端不需修改呼叫方式 | 保持參數與回傳結構不變 |


## 4. 測試檢核  
| 測試項目     | 說明                     | 優先 |
|------------|------------------------|----|
| 基本功能驗證 | 確認資料拿得對             | 高  |
| 快取機制    | 相同條件不重送             | 中  |
| 錯誤處理    | 模擬後端錯誤需顯示錯誤提示      | 中  |

> *PM 填寫：請依專案需求補充或刪減*

## 5. 重構要點  
- **統一入口**：所有地圖資料由 fetchMapData() 處理  
- **快取 & 去重**：同條件不重複呼叫 API  
- **錯誤提示**：回錯誤時前端要有顯示  
- **向下相容**：舊版功能改動後無差異

## 6. 補充說明


---

## 附錄：TDD 重構流程提醒 (TDD Refactoring Workflow)

1. **建立現有行為測試（回歸測試）**  
   - 在重構前，以現有邏輯為基礎撰寫完整測試，涵蓋核心邏輯與邊界條件。  
   - 確保重構後行為一致，避免產生 regression bug。

2. **小步重構與測試通過**  
   - 分階段替換架構與邏輯，每一步均須測試通過（綠燈）才進行下一步。  
   - 保持重構與行為改變區分清楚，不混合多重修改。

3. **更新文件與模組說明**  
   - 新增或更新 Hook、服務模組與資料流文件，確保團隊能理解新結構。  
   - 同步更新單元測試與驗收規格。

4. **刪除舊邏輯與驗證回歸測試通過**  
   - 移除重構前的模組與程式碼，並再次執行所有測試以驗證系統完整性。

5. **記錄變更與版本控制**  
   - 修改本文建明確記錄此次重構目的、模組改動、測試覆蓋範圍，供後續維護與審查使用。